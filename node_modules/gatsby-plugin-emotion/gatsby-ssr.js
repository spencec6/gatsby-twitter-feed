"use strict";

var _stringify = require("babel-runtime/core-js/json/stringify");

var _stringify2 = _interopRequireDefault(_stringify);

var _react = require("react");

var _react2 = _interopRequireDefault(_react);

var _server = require("react-dom/server");

var _emotionServer = require("emotion-server");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.replaceRenderer = function (_ref) {
  var bodyComponent = _ref.bodyComponent,
      replaceBodyHTMLString = _ref.replaceBodyHTMLString,
      setHeadComponents = _ref.setHeadComponents;

  var _extractCritical = (0, _emotionServer.extractCritical)((0, _server.renderToString)(bodyComponent)),
      html = _extractCritical.html,
      ids = _extractCritical.ids,
      css = _extractCritical.css;

  var criticalStyle = _react2.default.createElement("style", { dangerouslySetInnerHTML: { __html: css } });
  var criticalIds = _react2.default.createElement("script", {
    dangerouslySetInnerHTML: {
      __html: "window.__EMOTION_CRITICAL_CSS_IDS__ = " + (0, _stringify2.default)(ids) + ";"
    }
  });

  setHeadComponents([criticalIds, criticalStyle]);
  replaceBodyHTMLString(html);
};